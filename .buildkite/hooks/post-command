#!/usr/bin/env bash

BUILDEVENT_API_KEY=$CI_BUILDEVENT_API_KEY \
BUILDEVENT_DATASET=buildkite \
  ./buildevents step $BUILDKITE_BUILD_ID $BUILDKITE_STEP_ID $STEP_START $BUILDKITE_STEP_KEY 

if [ $BUILDKITE_COMMAND_EXIT_STATUS -ne 0 ]; then
  BUILDEVENT_API_KEY=$CI_BUILDEVENT_API_KEY \
    BUILDEVENT_DATASET=buildkite \
    ./buildevents build $BUILDKITE_BUILD_ID $BUILD_START_TIME failure
fi
